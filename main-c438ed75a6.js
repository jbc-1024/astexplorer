"use strict";function _createForOfIteratorHelper(e,t){var n,r,a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return a&&(e=a),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:(r=function(e){throw e},o.toString=function(){return r.toString()},o),f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e){return r.apply(this,arguments)}var i,l,s=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:(l=function(e){c=!0,i=e},u.toString=function(){return l.toString()},u),f:function(){try{s||null==a.return||a.return()}finally{if(c)throw i}}};function u(e){return l.apply(this,arguments)}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _globalAst={},globalAstSet=function(e){_globalAst=e},globalAstGet=function(){return _globalAst},domFromString=function(e){return(new DOMParser).parseFromString(e,"text/html").body.childNodes[0]},bindEventHover=function(){e("#display").addEventListener("mouseover",function(e){var e=e.path.find(function(e){return"classList"in e&&e.classList.contains("node")}),t=globalEditorGet(),n=t.doc.getAllMarks();if(n.forEach(function(e){return e.clear()}),null!=e){var r,n=JSON.parse(e.children[0].dataset.indice),a=globalAstGet(),o=_createForOfIteratorHelper(n);try{for(o.s();!(r=o.n()).done;)a=a[r.value]}catch(e){o.e(e)}finally{o.f()}e=a.loc.start,n=a.loc.end,e={line:e.line-1,ch:e.column-1},n={line:n.line-1,ch:n.column-1};t.markText(e,n,{className:"mark"})}})},astToDom=function(e){var t,e=JSON.parse(e.dataset.indice),n=globalAstGet(),r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;)n=n[t.value]}catch(e){r.e(e)}finally{r.f()}return n},bindEventToggle=function(){e("#display").addEventListener("click",function(e){var t,n,r,a,o,i,l=e.target;l.classList.contains("type-entry")?(n=(t=e.path.find(function(e){return e.classList.contains("node")})).parentElement,r=JSON.parse(l.dataset.indice),a=astToDom(l),i=(o=t.classList.contains("detailed")?tagTree(a,r,null):tagTree(a,r,a),domFromString(o)),n.replaceChild(i,t)):l.classList.contains("key-entry")&&(n=(t=l.parentElement.children[2]).parentElement,r=JSON.parse(l.dataset.indice),a=astToDom(l),t.classList.contains("detailed")?(o=tagTree(a,r,null),i=domFromString(o),n.replaceChild(i,t),l.classList.remove("open")):(o=tagTree(a,r,a),i=domFromString(o),n.replaceChild(i,t),l.classList.add("open")))})},canOpenClose=function(e){return!isNull(e)&&(!!isNode(e)||(isDict(e)?0<Object.keys(e).length:!!isArray(e)&&0<e.length))},bindEventSwitchMode=function(){var n,r=e("#toolbar").querySelectorAll("button"),t=_createForOfIteratorHelper(r);try{for(t.s();!(n=t.n()).done;)!function(){var t=n.value;t.addEventListener("click",function(e){r.forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"),refresh()})}()}catch(e){t.e(e)}finally{t.f()}},activeModeName=function(){var t=e("#toolbar");return Array.from(t.querySelectorAll("button")).find(function(e){return e.classList.contains("active")}).dataset.mode},refreshTree=function(){var t=astFromCmCode(),t=(globalAstSet(t),tagTree(t,[],null));e("#tree").innerHTML=t},refreshJson=function(){var t=astFromCmCode(),n=(globalAstSet(t),e("#json")),n=CodeMirror(n,{lineNumbers:!0,indentUnit:2,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],readOnly:!0,mode:"application/json"}),t=JSON.stringify(t,null,2);n.setValue(t)},refresh=function(){var t=e("#display"),n=activeModeName();"tree"==n?(t.innerHTML='<div id="tree"></div>',refreshTree()):"json"==n&&(t.innerHTML='<div id="json"></div>',refreshJson())},bindEventSwitchLang=function(){var t,n=e("#langlist"),r=n.querySelector(".langs").querySelectorAll(".lang"),a=n.querySelector(".active-lang"),o=_createForOfIteratorHelper(r);try{for(o.s();!(t=o.n()).done;)!function(){var r=t.value;r.addEventListener("click",function(e){var t=r.dataset.lang,n="<span>".concat(t,"</span>");a.innerHTML=n,a.dataset.lang=t,setNewLang(t)})}()}catch(e){o.e(e)}finally{o.f()}},parse=function(t){var n=e("#langlist").querySelector(".active-lang").dataset.lang;return parserByLang(n)(t)},astFromCmCode=function(){var e=globalEditorGet().getValue();return parse(e)},__init=function(){setupLangList(),setupEditor()},__bindEvents=function(){bindEventToggle(),bindEventHover(),bindEventSwitchLang(),bindEventSwitchMode(),preventDefaultSave()},__main=function(){__init(),__bindEvents()};__main();