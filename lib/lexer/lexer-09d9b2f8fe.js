"use strict";function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){a=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var isDigit=function(e){return-1!=="0123456789".indexOf(e)},isAlpha=function(e){return-1!=="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_".indexOf(e)};function HtmlToText(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText||t.textContent}var TokenType={plus:"plus",minus:"minus",divide:"divide",multiply:"multiply",lparam:"lparam",rparam:"rparam",integer:"integer",assign:"assign",identifier:"identifier",keyword:"keyword",dot:"dot",colon:"colon",comma:"comma",lbracket:"lbracket",rbracket:"rbracket",lcurly:"lcurly",rcurly:"rcurly",semicolon:"semicolon",singlequotes:"singlequotes",doublequotes:"singlequotes",backtick:"backtick",string:"string",singleComments:"singleComments",multiComments:"multiComments",htmlComments:"htmlComments",less:"less",greater:"greater",lessEqual:"lessEqual",greaterEqual:"greaterEqual",plusEqual:"plusEqual",minusEqual:"minusEqual",divideEqual:"divideEqual",multiplyEqual:"multiplyEqual",equalEqual:"equalEqual",at:"at",poundKey:"poundKey",excalmation:"excalmation",notEqual:"notEqual"},randomNum=function(e,t){switch(arguments.length){case 1:return parseInt(Math.random()*e+1,10);case 2:return parseInt(Math.random()*(t-e+1)+e,10);default:return 0}},getRandomColor=function(){var e=Math.floor(randomNum(150,255)),t=Math.floor(randomNum(100,150)),i=Math.floor(randomNum(150,255)),o=randomNum(3);return 1==o?e=Math.floor(randomNum(0,50)):2==o?t=Math.floor(randomNum(0,50)):3==o&&(i=Math.floor(randomNum(0,50))),"rgba( ".concat(e," , ").concat(t,", ").concat(i,", 1)")},colorfulTokenType=function(e){for(var t={},i=0,o=Object.keys(e);i<o.length;i++){var n=e[o[i]],r=getRandomColor(),s=getRandomColor();t[n]=[r,s]}return t},TokenTypeColor=colorfulTokenType(TokenType),Token=_createClass(function e(t,i,o,n){_classCallCheck(this,e),this.type=t,this.value=i,this.start=o,this.end=n}),Lexer=function(){function i(e){var t;_classCallCheck(this,i),this.text=e,this.startRow=1,this.startColumn=1,this.currentRow=1,this.currentColumn=1,this.position=0,this.current_char=this.text[this.position],this.tokenList=[],this.Operators={"+":TokenType.plus,"-":TokenType.minus,"*":TokenType.multiply,"/":TokenType.divide,"<":TokenType.less,">":TokenType.greater,"+=":TokenType.plusEqual,"-=":TokenType.minusEqual,"*=":TokenType.multiplyEqual,"/=":TokenType.divideEqual,"<=":TokenType.lessEqual,">=":TokenType.greaterEqual,"==":TokenType.equalEqual,"!=":TokenType.notEqual,"=":TokenType.assign,"!":TokenType.excalmation},this.symbols=(_defineProperty(t={"(":TokenType.lparam,")":TokenType.rparam,".":TokenType.dot,":":TokenType.colon,";":TokenType.semicolon,"{":TokenType.lcurly,"}":TokenType.rcurly,"[":TokenType.lbracket,"]":TokenType.rbracket,",":TokenType.comma},"]",TokenType.rbracket),_defineProperty(t,",",TokenType.comma),_defineProperty(t,"%",TokenType.divide),_defineProperty(t,"@",TokenType.at),_defineProperty(t,"#",TokenType.poundKey),t),this.stringBegin={"'":TokenType.singlequotes,'"':TokenType.doublequotes,"`":TokenType.backtick},this.ReservedKeywords={var:TokenType.keyword,const:TokenType.keyword,function:TokenType.keyword,return:TokenType.keyword,while:TokenType.keyword,break:TokenType.keyword,continue:TokenType.keyword,for:TokenType.keyword,in:TokenType.keyword,if:TokenType.keyword,else:TokenType.keyword}}return _createClass(i,[{key:"getLocation",value:function(){return{line:this.row,column:this.column}}},{key:"error",value:function(){log("Error Lexer input")}},{key:"getTokens",value:function(){for(var e=this.text.trim();this.position<e.length;){var t=this.text[this.position],i=this.text[this.position+1];if("\n"===t)this.row+=1,this.position+=1;else if(" "===t||"\t"===t||"\r"===t)this.position+=1;else if("/"==t&&"/"===i){var o=this._singleComments(t),n=new Token(TokenType.singleComments,o[0],o[1],o[2]);this.tokenList.push(n)}else if("/"==t&&"*"===i){var r=this._multiComments(t),s=new Token(TokenType.multiComments,r[0],r[1],r[2]);this.tokenList.push(s)}else if("<"==t&&"!"===i){var a=this._htmlComments(t),l=new Token(TokenType.htmlComments,a[0],a[1],a[2]);this.tokenList.push(l)}else if(isDigit(t)){var u=this.integer(),p=new Token(TokenType.integer,u[0],u[1],u[2]);this.tokenList.push(p)}else if(isAlpha(t)){var h=this._id();if(-1!==Object.keys(this.ReservedKeywords).indexOf(h)){var y=new Token(TokenType.keyword,h[0],h[1],h[2]);this.tokenList.push(y)}else{var T=new Token(TokenType.identifier,h[0],h[1],h[2]);this.tokenList.push(T)}}else if(this.Operators[t]){if("="===this.text[this.position+1]){var c=this.getPosition();t+="=";var k=this.Operators[t];this.position+=2;var m=this.getPosition(),f=new Token(k,t,c,m);this.tokenList.push(f)}else{var g=this.getPosition(),d=this.Operators[t];this.position+=1;var v=this.getPosition(),w=new Token(d,t,g,v);this.tokenList.push(w)}}else if(this.symbols[t]){var b=this.getPosition(),_=this.symbols[t];this.position+=1;var q=this.getPosition(),C=new Token(_,t,b,q);this.tokenList.push(C)}else{if(!this.stringBegin[t]){log("tokenizer 中字符: （ ".concat(t," )  没有处理"));break}var E=this._string(t),P=new Token(TokenType.string,E[0],E[1],E[2]);this.tokenList.push(P)}}return this.tokenList}},{key:"_singleComments",value:function(){for(var e=this.getPosition(),t=this.text,i="";this.position<t.length&&"\n"!==t[this.position];){i+=t[this.position],this.position+=1}return this.position+=1,[i,e,this.getPosition()]}},{key:"_htmlComments",value:function(){for(var e=this.getPosition(),t=this.text,i="";this.position<t.length&&">"!==t[this.position];){i+=t[this.position],this.position+=1}return i=(i=(i+=">").replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;"),this.position+=1,[i,e,this.getPosition()]}},{key:"_multiComments",value:function(){for(var e=this.getPosition(),t=this.text,i="";this.position<t.length&&("*"!=t[this.position]||"/"!=t[this.position+1]);){i+=t[this.position],this.position+=1}return i+="*/",this.position+=2,[i,e,this.getPosition()]}},{key:"_string",value:function(e){var t=this.getPosition(),i=this.text;this.position+=1;for(var o="";this.position<i.length&&i[this.position]!==e;){o+=i[this.position],this.position+=1}return this.position+=1,[o=(o=(o=e+o+e).replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;"),t,this.getPosition()]}},{key:"_id",value:function(){for(var e=this.getPosition(),t="",i=this.text;this.position<i.length&&(isAlpha(i[this.position])||isDigit(i[this.position])||"_"===i[this.position]||"-"===i[this.position]);)t+=i[this.position],this.position+=1;return[t,e,this.getPosition()]}},{key:"integer",value:function(){for(var e=this.getPosition(),t="",i=this.text;this.position<i.length&&(isDigit(i[this.position])||"."===i[this.position]);)t+=i[this.position],this.position+=1;var o=this.getPosition();return[parseFloat(t),e,o]}},{key:"getPosition",value:function(){var e,t=this.position,i=[],o=_createForOfIteratorHelper(this.text.split("\n"));try{for(o.s();!(e=o.n()).done;){var n=e.value;i.push(n.length+1)}}catch(e){o.e(e)}finally{o.f()}for(var r=0,s=0;s<i.length;s++){var a=i[s];if(r<=t&&t<r+a)return{line:s+1,column:t-r+1};if(t===r+a)return{line:s+2,column:1};r+=a}throw Error("没找到坐标对应的位置")}}]),i}();