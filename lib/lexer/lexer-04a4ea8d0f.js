"use strict";function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var isDigit=function(e){return-1!=="0123456789".indexOf(e)},isAlpha=function(e){return-1!=="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_".indexOf(e)};function HtmlToText(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText||t.textContent}var TokenType={plus:"plus",minus:"minus",divide:"divide",multiply:"multiply",lparam:"lparam",rparam:"rparam",integer:"integer",assign:"assign",identifier:"identifier",keyword:"keyword",dot:"dot",colon:"colon",comma:"comma",lbracket:"lbracket",rbracket:"rbracket",lcurly:"lcurly",rcurly:"rcurly",semicolon:"semicolon",singlequotes:"singlequotes",doublequotes:"singlequotes",backtick:"backtick",string:"string",singleComments:"singleComments",multiComments:"multiComments",htmlComments:"htmlComments",less:"less",greater:"greater",lessEqual:"lessEqual",greaterEqual:"greaterEqual",plusEqual:"plusEqual",minusEqual:"minusEqual",divideEqual:"divideEqual",multiplyEqual:"multiplyEqual",equalEqual:"equalEqual",at:"at",poundKey:"poundKey",excalmation:"excalmation",notEqual:"notEqual"},randomNum=function(e,t){switch(arguments.length){case 1:return parseInt(Math.random()*e+1,10);case 2:return parseInt(Math.random()*(t-e+1)+e,10);default:return 0}},getRandomColor=function(){var e=Math.floor(randomNum(150,255)),t=Math.floor(randomNum(100,150)),i=Math.floor(randomNum(150,255)),o=randomNum(3);return 1==o?e=Math.floor(randomNum(0,50)):2==o?t=Math.floor(randomNum(0,50)):3==o&&(i=Math.floor(randomNum(0,50))),"rgba( ".concat(e," , ").concat(t,", ").concat(i,", 1)")},colorfulTokenType=function(e){for(var t={},i=0,o=Object.keys(e);i<o.length;i++){var n=e[o[i]],s=getRandomColor(),r=getRandomColor();t[n]=[s,r]}return t},TokenTypeColor=colorfulTokenType(TokenType),Token=_createClass(function e(t,i){_classCallCheck(this,e),this.type=t,this.value=i}),Lexer=function(){function i(e){var t;_classCallCheck(this,i),this.text=e,this.position=0,this.current_char=this.text[this.position],this.tokenList=[],this.Operators={"+":TokenType.plus,"-":TokenType.minus,"*":TokenType.multiply,"/":TokenType.divide,"<":TokenType.less,">":TokenType.greater,"+=":TokenType.plusEqual,"-=":TokenType.minusEqual,"*=":TokenType.multiplyEqual,"/=":TokenType.divideEqual,"<=":TokenType.lessEqual,">=":TokenType.greaterEqual,"==":TokenType.equalEqual,"!=":TokenType.notEqual,"=":TokenType.assign,"!":TokenType.excalmation},this.symbols=(_defineProperty(t={"(":TokenType.lparam,")":TokenType.rparam,".":TokenType.dot,":":TokenType.colon,";":TokenType.semicolon,"{":TokenType.lcurly,"}":TokenType.rcurly,"[":TokenType.lbracket,"]":TokenType.rbracket,",":TokenType.comma},"]",TokenType.rbracket),_defineProperty(t,",",TokenType.comma),_defineProperty(t,"%",TokenType.divide),_defineProperty(t,"@",TokenType.at),_defineProperty(t,"#",TokenType.poundKey),t),this.stringBegin={"'":TokenType.singlequotes,'"':TokenType.doublequotes,"`":TokenType.backtick},this.ReservedKeywords={var:TokenType.keyword,const:TokenType.keyword,function:TokenType.keyword,return:TokenType.keyword,while:TokenType.keyword,break:TokenType.keyword,continue:TokenType.keyword,for:TokenType.keyword,in:TokenType.keyword,if:TokenType.keyword,else:TokenType.keyword}}return _createClass(i,[{key:"error",value:function(){log("Error Lexer input")}},{key:"getTokens",value:function(){for(var e=this.text.trim();this.position<e.length;){var t=this.text[this.position],i=this.text[this.position+1];if(" "===t||"\n"===t||"\t"===t||"\r"===t)this.position+=1;else if("/"==t&&"/"===i){var o=this._singleComments(t),n=new Token(TokenType.singleComments,o);this.tokenList.push(n)}else if("/"==t&&"*"===i){var s=this._multiComments(t),r=new Token(TokenType.multiComments,s);this.tokenList.push(r)}else if("<"==t&&"!"===i){var a=this._htmlComments(t),l=new Token(TokenType.htmlComments,a);this.tokenList.push(l)}else if(isDigit(t)){var p=this.integer(),u=new Token(TokenType.integer,p);this.tokenList.push(u)}else if(isAlpha(t)){var h=this._id();if(-1!==Object.keys(this.ReservedKeywords).indexOf(h)){var T=new Token(TokenType.keyword,h);this.tokenList.push(T)}else{var k=new Token(TokenType.identifier,h);this.tokenList.push(k)}}else if(this.Operators[t]){if("="===this.text[this.position+1]){t+="=";var y=this.Operators[t],m=new Token(y,t);this.tokenList.push(m),this.position+=2}else{var c=this.Operators[t],d=new Token(c,t);this.tokenList.push(d),this.position+=1}}else if(this.symbols[t]){var f=this.symbols[t],g=new Token(f,t);this.tokenList.push(g),this.position+=1}else{if(!this.stringBegin[t]){log("tokenizer 中字符: （ ".concat(t," )  没有处理"));break}var v=this._string(t),w=new Token(TokenType.string,v);this.tokenList.push(w)}}return this.tokenList}},{key:"_singleComments",value:function(){for(var e=this.text,t="";this.position<e.length&&"\n"!==e[this.position];){t+=e[this.position],this.position+=1}return this.position+=1,t}},{key:"_htmlComments",value:function(){for(var e=this.text,t="";this.position<e.length&&">"!==e[this.position];){t+=e[this.position],this.position+=1}return t=(t=(t+=">").replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;"),this.position+=2,t}},{key:"_multiComments",value:function(){for(var e=this.text,t="";this.position<e.length&&("*"!=e[this.position]||"/"!=e[this.position+1]);){t+=e[this.position],this.position+=1}return t+="*/",this.position+=2,t}},{key:"_string",value:function(e){var t=this.text;this.position+=1;for(var i="";this.position<t.length&&t[this.position]!==e;){i+=t[this.position],this.position+=1}return this.position+=1,i=(i=(i=e+i+e).replace(new RegExp("<","gm"),"&lt;")).replace(new RegExp(">","gm"),"&gt;")}},{key:"_id",value:function(){for(var e="",t=this.text;this.position<t.length&&(isAlpha(t[this.position])||isDigit(t[this.position])||"_"===t[this.position]||"-"===t[this.position]);)e+=t[this.position],this.position+=1;return e}},{key:"integer",value:function(){for(var e="",t=this.text;this.position<t.length&&(isDigit(t[this.position])||"."===t[this.position]);)e+=t[this.position],this.position+=1;return parseFloat(e)}}]),i}();